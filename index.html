<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PontalZen - Localização com Autocomplete Gratuito</title>

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

  <style>
    :root{
      --primary:#2563eb; --primary-dark:#1d4ed8;
      --secondary:#059669; --accent:#dc2626;
      --ring:#e2e8f0; --text:#0f172a; --muted:#64748b;
      --card:#fff;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background:linear-gradient(135deg,#f0f9ff,#e0f2fe)}
    /* Header */
    header{position:sticky; top:0; z-index:10; color:#fff;
      background:linear-gradient(135deg,var(--primary),var(--primary-dark));
      box-shadow:0 6px 24px rgba(37,99,235,.35)}
    .header-wrap{max-width:1200px; margin:0 auto; padding:16px 20px; display:flex; align-items:center; justify-content:space-between}
    .brand{display:flex; gap:12px; align-items:center}
    .brand img{width:44px; height:44px; border-radius:50%; object-fit:cover; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,.15)}
    .brand h1{margin:0; font-size:22px; font-weight:800}
    .cta-header{background:linear-gradient(135deg,#25D366,#128C7E); color:#fff; padding:10px 16px; border-radius:999px; font-weight:700; text-decoration:none; display:flex; gap:10px; align-items:center; box-shadow:0 8px 20px rgba(37,211,102,.45)}
    /* Hero */
    .hero{color:#fff; text-align:center; background:linear-gradient(135deg,var(--primary),var(--primary-dark)); padding:56px 20px}
    .hero h2{margin:0 0 10px; font-size:36px; font-weight:800}
    .hero p{margin:0 auto 20px; max-width:820px; font-size:18px; opacity:.95}
    .cta-lg{background:linear-gradient(135deg,#25D366,#128C7E); color:#fff; padding:14px 26px; border-radius:999px; font-weight:800; text-decoration:none; display:inline-flex; gap:10px; align-items:center}
    /* Layout */
    .container{max-width:1200px; margin:40px auto; padding:0 20px}
    .card{background:var(--card); border:1px solid var(--ring); border-radius:20px; box-shadow:0 12px 32px rgba(0,0,0,.06); padding:22px}
    .section-title{margin:0 0 18px; font-size:22px; font-weight:800; color:var(--primary-dark); border-left:6px solid var(--accent); padding-left:12px}
    .grid{display:grid; grid-template-columns:1.4fr 1fr; gap:22px}
    @media (max-width:920px){.grid{grid-template-columns:1fr}}
    /* Serviços (exemplo compacto) */
    .services{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px}
    .service{border:1px solid var(--ring); border-radius:16px; padding:16px; text-align:center; transition:transform .25s, box-shadow .25s; background:#fff}
    .service:hover{transform:translateY(-6px); box-shadow:0 16px 36px rgba(37,99,235,.18)}
    .ico{width:60px;height:60px;border-radius:50%;display:grid;place-items:center;margin:0 auto 10px;color:#fff;background:linear-gradient(135deg,var(--primary),var(--primary-dark))}
    .muted{color:var(--muted)}

    /* Localização */
    #map{width:100%; height:340px; border-radius:16px; border:1px solid var(--ring)}
    .field{display:flex; flex-direction:column; gap:8px; margin-bottom:12px}
    .field input, .field textarea, .field button{font:inherit; padding:12px 14px; border:1px solid var(--ring); border-radius:12px; background:#fff}
    .field textarea{resize:vertical}
    .btn{cursor:pointer; border:0; border-radius:12px; padding:12px 14px; font-weight:700}
    .btn-primary{background:var(--primary); color:#fff}
    .btn-outline{background:#fff; color:var(--primary-dark); border:1px solid var(--ring)}
    .row{display:flex; gap:10px; flex-wrap:wrap}

    /* Autocomplete */
    .ac-wrap{position:relative}
    .ac-input{padding-left:38px}
    .ac-icon{position:absolute; left:10px; top:50%; transform:translateY(-50%); color:#475569}
    .ac-list{
      position:absolute; top:100%; left:0; right:0; z-index:20;
      background:#fff; border:1px solid var(--ring); border-radius:12px; margin-top:6px; list-style:none; padding:6px 0;
      max-height:260px; overflow:auto; box-shadow:0 12px 28px rgba(0,0,0,.12); display:none
    }
    .ac-list.show{display:block}
    .ac-item{padding:10px 12px; cursor:pointer}
    .ac-item:hover{background:#f8fafc}
    .pill{display:inline-flex; gap:8px; align-items:center; background:#f1f5f9; padding:8px 12px; border-radius:999px; font-weight:600; font-size:14px}

    /* WhatsApp flutuante */
    .float-wa{position:fixed; right:22px; bottom:22px; width:60px; height:60px; border-radius:50%; display:grid; place-items:center; color:#fff; z-index:50; background:linear-gradient(135deg,#25D366,#128C7E); box-shadow:0 10px 26px rgba(37,211,102,.5)}
    footer{margin:50px 0 24px; text-align:center; color:#334155; font-weight:600}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-wrap">
      <div class="brand">
        <img src="download (1).png" alt="PontalZen">
        <h1>PontalZen • Centro Médico</h1>
      </div>
      <a class="cta-header" href="https://wa.me/554184999939" target="_blank" rel="noopener">
        <i class="fa-brands fa-whatsapp"></i> Agendar no WhatsApp
      </a>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <h2>Cuidando da sua saúde com excelência e carinho</h2>
    <p>Atendimento médico em Pontal do Paraná com qualidade, conforto e profissionalismo para toda a família.</p>
    <a class="cta-lg" href="https://wa.me/554184999939" target="_blank" rel="noopener">
      <i class="fa-brands fa-whatsapp"></i> Agende sua consulta agora
    </a>
  </section>

  <main class="container">
    <!-- Serviços (exemplo) -->
    <section class="card">
      <h3 class="section-title">Nossas Especialidades</h3>
      <div class="services">
        <div class="service"><div class="ico"><i class="fa-solid fa-user-md"></i></div><h4>Urologia</h4><p class="muted">Saúde do sistema urinário e masculino.</p></div>
        <div class="service"><div class="ico"><i class="fa-solid fa-syringe"></i></div><h4>Endocrinologia</h4><p class="muted">Distúrbios hormonais e metabólicos.</p></div>
        <div class="service"><div class="ico"><i class="fa-solid fa-user-nurse"></i></div><h4>Geriatria</h4><p class="muted">Cuidado integral ao idoso.</p></div>
        <div class="service"><div class="ico"><i class="fa-solid fa-stethoscope"></i></div><h4>Clínico Geral</h4><p class="muted">Atenção primária e preventiva.</p></div>
        <div class="service"><div class="ico"><i class="fa-solid fa-brain"></i></div><h4>Psiquiatria</h4><p class="muted">Saúde mental e emocional.</p></div>
      </div>
    </section>

    <!-- Localização + Ações -->
    <section class="card">
      <h3 class="section-title">Localização e envio da sua posição</h3>
      <div class="grid">
        <!-- Mapa -->
        <div>
          <div id="map" aria-label="Mapa para marcar localização"></div>
          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap">
            <span class="pill"><i class="fa-solid fa-location-dot"></i> Clique no mapa para marcar</span>
            <span class="pill"><i class="fa-solid fa-arrows-up-down-left-right"></i> Arraste o pino para ajustar</span>
          </div>
        </div>

        <!-- Formulário / Ações -->
        <div>
          <div class="field">
            <label><strong>Buscar endereço</strong></label>
            <div class="ac-wrap">
              <i class="fa-solid fa-magnifying-glass ac-icon"></i>
              <input id="search" class="ac-input" type="text" placeholder="Rua, número, bairro, cidade..." autocomplete="off"/>
              <ul id="searchResults" class="ac-list" role="listbox" aria-label="Sugestões de endereços"></ul>
            </div>
          </div>

          <div class="field">
            <label for="name"><strong>Seu nome</strong></label>
            <input id="name" type="text" placeholder="Ex.: Maria Silva"/>
          </div>

          <div class="row">
            <div class="field" style="flex:1">
              <label for="apptDate"><strong>Data</strong></label>
              <input id="apptDate" type="date"/>
            </div>
            <div class="field" style="flex:1">
              <label for="apptTime"><strong>Horário</strong></label>
              <input id="apptTime" type="time"/>
            </div>
          </div>

          <div class="field">
            <label for="notes"><strong>Observações (opcional)</strong></label>
            <textarea id="notes" rows="3" placeholder="Referência do local, bloco, cor do portão, etc."></textarea>
          </div>

          <div class="field">
            <label for="address"><strong>Endereço selecionado</strong></label>
            <input id="address" type="text" readonly placeholder="Clique no mapa, use o GPS ou busque acima"/>
          </div>

          <div class="row">
            <button id="btnLocate" class="btn btn-outline"><i class="fa-solid fa-location-crosshairs"></i> Usar minha localização</button>
            <button id="btnClear" class="btn btn-outline"><i class="fa-solid fa-eraser"></i> Limpar marcação</button>
          </div>

          <div class="row" style="margin-top:10px">
            <button id="btnSend" class="btn btn-primary" disabled>
              <i class="fa-brands fa-whatsapp"></i> Enviar localização via WhatsApp
            </button>
          </div>

          <div style="margin-top:14px" class="muted">
            Endereço da clínica: Rua Tomário Martins, esquina com Rua Tibagi, 939 — Praia de Leste, Pontal do Paraná - PR
          </div>
        </div>
      </div>
    </section>

    <!-- Exames -->
    <section class="card">
      <h3 class="section-title">Exames Realizados</h3>
      <ul class="muted" style="margin:0; padding-left:18px">
        <li>Ecografia Abdominal</li>
        <li>Ecografia Urológica</li>
        <li>Urofluxometrias</li>
      </ul>
    </section>
  </main>

  <!-- WhatsApp flutuante -->
  <a class="float-wa" href="https://wa.me/554184999939" target="_blank" aria-label="Abrir WhatsApp">
    <i class="fa-brands fa-whatsapp" style="font-size:28px"></i>
  </a>

  <footer>
    © 2025 Centro Médico PontalZen — Cuidando da sua saúde com dedicação e profissionalismo
  </footer>

  <script>
    // ============== Configurações (edite aqui) ==============
    const CLINIC_WHATSAPP = "554184999939";

    // Ponto central e zoom — sua localização
const START = { lat: -25.691589, lng: -48.469708, zoom: 15 };

// Tamanho da área para restringir buscas (em graus)
// 0.08 ≈ ~8–9 km a partir do centro
const DELTA_BOUNDS = 0.08;

// Caixa (bounding box) calculada
const BOUNDS = {
  minLat: START.lat - DELTA_BOUNDS, // -25.771589
  maxLat: START.lat + DELTA_BOUNDS, // -25.611589
  minLng: START.lng - DELTA_BOUNDS, // -48.549708
  maxLng: START.lng + DELTA_BOUNDS  // -48.389708
};
    // =========================================================

    // Mapa Leaflet
    const map = L.map('map', { zoomControl: false }).setView([START.lat, START.lng], START.zoom);
    L.control.zoom({ position: 'bottomright' }).addTo(map);

    // Tiles OSM
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    let marker = null;
    let currentLatLng = null;

    // Elementos de UI
    const nameEl = document.getElementById('name');
    const notesEl = document.getElementById('notes');
    const addressEl = document.getElementById('address');
    const apptDateEl = document.getElementById('apptDate');
    const apptTimeEl = document.getElementById('apptTime');
    const btnSend = document.getElementById('btnSend');

    function setMarker(latlng) {
      if (!marker) {
        marker = L.marker(latlng, { draggable: true }).addTo(map);
        marker.on('dragend', () => {
          const pos = marker.getLatLng();
          currentLatLng = pos;
          reverseGeocode(pos.lat, pos.lng);
          updateSendState();
        });
      } else {
        marker.setLatLng(latlng);
      }
      currentLatLng = latlng;
      reverseGeocode(latlng.lat, latlng.lng);
      updateSendState();
    }

    function clearMarker() {
      if (marker) { map.removeLayer(marker); marker = null; }
      currentLatLng = null;
      addressEl.value = '';
      updateSendState();
    }

    function updateSendState() {
      btnSend.disabled = !currentLatLng;
    }

    // Clique no mapa
    map.on('click', (e) => setMarker(e.latlng));

    // Geolocalização
    document.getElementById('btnLocate').addEventListener('click', () => {
      if (!navigator.geolocation) return alert('Geolocalização não é suportada neste dispositivo.');
      navigator.geolocation.getCurrentPosition(
        pos => {
          const latlng = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          setMarker(latlng);
          map.setView(latlng, 17);
        },
        err => alert('Não foi possível obter sua localização. Verifique permissões do navegador.')
      );
    });

    document.getElementById('btnClear').addEventListener('click', clearMarker);

    // Geocodificação reversa (Nominatim)
    async function reverseGeocode(lat, lng) {
      try {
        addressEl.value = 'Buscando endereço…';
        const email = 'pontal.zen@gmail.com';
        const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}&addressdetails=1&email=${encodeURIComponent(email)}`;
        const res = await fetch(url, { headers: { 'Accept-Language': 'pt-BR' }});
        const data = await res.json();
        addressEl.value = data.display_name || `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
      } catch (e) {
        addressEl.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
      }
    }

    // ===== Autocomplete (Photon com bbox e fallback Nominatim com viewbox) =====
    const searchInput = document.getElementById('search');
    const resultsList = document.getElementById('searchResults');

    function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

    function makeLabelFromPhoton(p){
      const pr = p.properties || {};
      const parts = [];
      if (pr.name) parts.push(pr.name);
      if (pr.housenumber) parts.push(pr.housenumber);
      const line1 = parts.join(' ');
      const line2 = [pr.street, pr.suburb, pr.city || pr.town || pr.village, pr.state, pr.country].filter(Boolean).join(', ');
      return [line1 || pr.street || pr.city || '', line2].filter(Boolean).join(', ');
    }

    async function photonSearch(q){
      // Bias por START e restrição por bbox (lon,lat ordem: left,bottom,right,top)
      const bias = `&lat=${START.lat}&lon=${START.lng}`;
      const bbox = `&bbox=${BOUNDS.minLng},${BOUNDS.minLat},${BOUNDS.maxLng},${BOUNDS.maxLat}`;
      const url = `https://photon.komoot.io/api/?q=${encodeURIComponent(q)}&lang=pt&limit=7${bias}${bbox}`;
      const r = await fetch(url);
      const j = await r.json();
      const feats = (j.features || []);
      return feats.map(f => ({
        label: makeLabelFromPhoton(f),
        lat: f.geometry.coordinates[1],
        lng: f.geometry.coordinates[0]
      })).filter(i => i.label);
    }

    async function nominatimSearch(q){
      // bounded=1 com viewbox (lon,lat: left,top,right,bottom) restringe resultados à área
      const viewbox = `${BOUNDS.minLng},${BOUNDS.maxLat},${BOUNDS.maxLng},${BOUNDS.minLat}`;
      const url = `https://nominatim.openstreetmap.org/search?format=jsonv2&q=${encodeURIComponent(q)}&addressdetails=1&limit=7&bounded=1&viewbox=${viewbox}&accept-language=pt-BR&countrycodes=br`;
      const r = await fetch(url, { headers: { 'Accept-Language': 'pt-BR' }});
      const j = await r.json();
      return j.map(it => ({
        label: it.display_name,
        lat: parseFloat(it.lat),
        lng: parseFloat(it.lon)
      }));
    }

    async function runSearch(q){
      if (!q || q.length < 3){ resultsList.classList.remove('show'); resultsList.innerHTML=''; return; }
      try{
        let items = await photonSearch(q);
        // Garante restrição forte: se Photon retornar vazio, usa Nominatim restrito
        if (!items.length) items = await nominatimSearch(q);
        renderSuggestions(items);
      } catch(e){
        const items = await nominatimSearch(q).catch(()=>[]);
        renderSuggestions(items || []);
      }
    }

    const debouncedSearch = debounce(runSearch, 250);

    function renderSuggestions(items){
      resultsList.innerHTML = '';
      if (!items.length){ resultsList.classList.remove('show'); return; }
      items.forEach((it) => {
        const li = document.createElement('li');
        li.className = 'ac-item';
        li.setAttribute('role','option');
        li.textContent = it.label;
        li.addEventListener('click', () => chooseSuggestion(it));
        resultsList.appendChild(li);
      });
      resultsList.classList.add('show');
    }

    function chooseSuggestion(item){
      resultsList.classList.remove('show');
      searchInput.value = item.label;
      addressEl.value = item.label;
      const latlng = { lat: item.lat, lng: item.lng };
      setMarker(latlng);
      map.setView(latlng, 17);
    }

    searchInput.addEventListener('input', () => debouncedSearch(searchInput.value.trim()));
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter'){
        const first = resultsList.querySelector('.ac-item');
        if (first){ first.click(); e.preventDefault(); }
      }
    });
    document.addEventListener('click', (e) => {
      if(!e.target.closest('.ac-wrap')) resultsList.classList.remove('show');
    });

    // Enviar via WhatsApp
    btnSend.addEventListener('click', () => {
      if (!currentLatLng) return;
      const lat = currentLatLng.lat.toFixed(6);
      const lng = currentLatLng.lng.toFixed(6);
      const gmaps = `https://www.google.com/maps?q=${lat},${lng}`;
      const name  = (nameEl.value  || '').trim();
      const notes = (notesEl.value || '').trim();
      const addr  = (addressEl.value || '').trim();
      const date  = (apptDateEl.value || '').trim();
      const time  = (apptTimeEl.value || '').trim();
      const dataHora = (date || time) ? `${date || '—'} ${time || ''}`.trim() : '—';

      const msg =
`Olá, sou ${name || 'paciente'} e gostaria de agendar uma consulta.

Data/Horário desejados:
${dataHora}

Minha localização:
${addr}
(Coordenadas: ${lat}, ${lng})
Link: ${gmaps}

Observações:
${notes || '—'}`;

      const url = `https://wa.me/${CLINIC_WHATSAPP}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank', 'noopener');
    });
  </script>
</body>
</html>
